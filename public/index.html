<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messenger Webview</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100vh;
            overflow: auto; /* Allow scrolling */
        }
        .container {
            padding: 20px;
            max-width: 100%;
            box-sizing: border-box;
        }
        .status-message {
            padding: 10px;
            margin: 10px;
            border-radius: 4px;
            word-break: break-all;
        }
        .error {
            background-color: #ffebee;
            color: #c62828;
            border: 1px solid #ef9a9a;
        }
        .info {
            background-color: #e3f2fd;
            color: #1565c0;
            border: 1px solid #90caf9;
        }
    </style>
  </head>
  <body>
    <div id="root">
        <div id="status-container"></div>
    </div>

    <!-- Messenger Extensions SDK -->
    <script>
        let statusContainer = null;

        function showStatus(message, type = 'info') {
            if (!statusContainer) {
                statusContainer = document.getElementById('status-container');
            }
            if (!statusContainer) {
                console.error('Status container not found');
                return;
            }
            const statusDiv = document.createElement('div');
            statusDiv.className = `status-message ${type}`;
            statusDiv.textContent = message;
            statusContainer.appendChild(statusDiv);
            console.log(type + ':', message); // Also log to console
        }

        function checkMessengerEnvironment() {
            // Show all available window properties for debugging
            showStatus('Window properties:', 'info');
            showStatus(`window.name: ${window.name}`, 'info');
            showStatus(`window.top === window: ${window.top === window}`, 'info');
            showStatus(`window.parent === window: ${window.parent === window}`, 'info');
            showStatus(`document.referrer: ${document.referrer}`, 'info');
            
            // Check environment
            const environment = 
                window.name === 'messenger_ref' ? 'Messenger Web' :
                window.name === 'facebook_ref' ? 'Facebook Chat Tab' :
                'Unknown Environment';
            
            showStatus(`Running in: ${environment}`, 'info');
        }

        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', function() {
            try {
                checkMessengerEnvironment();
            } catch (error) {
                showStatus('Error checking environment: ' + error.message, 'error');
            }
        });

        // Messenger SDK initialization
        window.extAsyncInit = function() {
            try {
                showStatus('Messenger Extensions SDK loaded');
                
                if (window.MessengerExtensions) {
                    showStatus('MessengerExtensions is available');
                    
                    // Check supported features
                    window.MessengerExtensions.getSupportedFeatures(function success(result) {
                        showStatus('Supported features: ' + JSON.stringify(result), 'info');
                    }, function error(err) {
                        showStatus('Error getting supported features: ' + JSON.stringify(err), 'error');
                    });
                } else {
                    showStatus('MessengerExtensions not available', 'error');
                }
            } catch (error) {
                showStatus('Error in extAsyncInit: ' + error.message, 'error');
            }
        };
        
        // Load the Messenger Extensions SDK
        (function(d, s, id){
            try {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) {return;}
                js = d.createElement(s); js.id = id;
                js.src = "https://connect.facebook.net/en_US/messenger.Extensions.js";
                if (fjs && fjs.parentNode) {
                    fjs.parentNode.insertBefore(js, fjs);
                    showStatus('SDK script tag added');
                } else {
                    showStatus('Could not find parent node for SDK script', 'error');
                }
            } catch (error) {
                showStatus('Error loading SDK: ' + error.message, 'error');
            }
        }(document, 'script', 'Messenger'));

        // Add timeout check
        setTimeout(function() {
            if (!window.MessengerExtensions) {
                showStatus('Messenger Extensions SDK failed to load after timeout', 'error');
            }
        }, 5000);
    </script>
  </body>
</html> 